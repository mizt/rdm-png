<!DOCTYPE html><html style="background-color:#FFF;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta id="viewport" name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" /><title>rdm-png</title><style>*{margin:0;padding:0;font-size:1pc;font-family:Helvetica,Arial,sans-serif;font-weight:400;-webkit-font-kerning:none;font-kerning:none;text-rendering:optimizeSpeed}body{width:100%;height:100vh}#stage,body{background-color:#FFF;}#stage{width:20in;height:810pt;opacity:0;-webkit-transition:opacity .15s ease-in;-moz-transition:opacity .15s ease-in;-o-transition:opacity .15s ease-in;transition:opacity .15s ease-in}@-webkit-keyframes a{0{-webkit-transform:rotate(0)}50%{-webkit-transform:rotate(180deg)}to{-webkit-transform:rotate(360deg)}}@keyframes a{0{transform:rotate(0)}50%{transform:rotate(180deg)}to{transform:rotate(360deg)}}div#loader{position:absolute;text-align:center;border-radius:50%;border-right-color:transparent;-webkit-animation:a 1.2s linear infinite;animation:a 1.2s linear infinite}div#loaderContainer{position:fixed;left:50%;top:50%;z-index:1;-webkit-transition:opacity .2s ease-out;-moz-transition:opacity .2s ease-out;-o-transition:opacity .2s ease-out;transition:opacity .2s ease-out;opacity:1;filter:alpha(opacity=100)}</style></head><body><script>(function(b,a){typeof exports==="object"&&typeof module!=="undefined"?module.exports=a():typeof define==="function"&&define.amd?define(a):(b.Stats=a())}(this,(function(){var a=function(){var h=0;var c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";c.addEventListener("click",function(l){l.preventDefault();k(++h%c.children.length)},false);function e(l){c.appendChild(l.dom);return l}function k(m){for(var l=0;l<c.children.length;l++){c.children[l].style.display=l===m?"block":"none"}h=m}var f=(performance||Date).now(),b=f,j=0;var i=e(new a.Panel("FPS","#0ff","#002"));var d=e(new a.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory){var g=e(new a.Panel("MB","#f08","#201"))}k(0);return{REVISION:16,dom:c,addPanel:e,showPanel:k,begin:function(){f=(performance||Date).now()},end:function(){j++;var l=(performance||Date).now();d.update(l-f,200);if(l>b+1000){i.update((j*1000)/(l-b),100);b=l;j=0;if(g){var m=performance.memory;g.update(m.usedJSHeapSize/1048576,m.jsHeapSizeLimit/1048576)}}return l},update:function(){f=this.end()},domElement:c,setMode:k}};a.Panel=function(c,b,j){var i=Infinity,m=0,r=Math.round;var l=r(window.devicePixelRatio||1);var n=80*l,k=48*l,h=3*l,g=2*l,q=3*l,o=15*l,p=74*l,f=30*l;var e=document.createElement("canvas");e.width=n;e.height=k;e.style.cssText="width:80px;height:48px";var d=e.getContext("2d");d.font="bold "+(9*l)+"px Helvetica,Arial,sans-serif";d.textBaseline="top";d.fillStyle=j;d.fillRect(0,0,n,k);d.fillStyle=b;d.fillText(c,h,g);d.fillRect(q,o,p,f);d.fillStyle=j;d.globalAlpha=0.9;d.fillRect(q,o,p,f);return{dom:e,update:function(s,t){i=Math.min(i,s);m=Math.max(m,s);d.fillStyle=j;d.globalAlpha=1;d.fillRect(0,0,n,o);d.fillStyle=b;d.fillText(r(s)+" "+c+" ("+r(i)+"-"+r(m)+")",h,g);d.drawImage(e,q+l,o,p-l,f,q,o,p-l,f);d.fillRect(q+p-l,o,l,f);d.fillStyle=j;d.globalAlpha=0.9;d.fillRect(q+p-l,o,l,r((1-(s/t))*f))}}};return a})));window.indicator={color:"#0FF",width:4,radius:100,loading:undefined,style:undefined,isPlay:false,setStyle:function(b){if(b){if(b&&b.radius&&b.weight&&b.color){this.style=b;if(this.loader){this.exec()}}}},exec:function(){if(this.style){loader.style.border=this.style.weight+"px solid "+this.style.color;loader.style.width=loader.style.height=this.style.radius+"px";loader.style.top=loader.style.left="-"+((this.style.weight+this.style.radius)>>1)+"px"}else{loader.style.border=this.width+"px solid "+this.color;loader.style.width=loader.style.height=this.radius+"px";loader.style.left="-"+((this.radius+this.width)>>1)+"px";loader.style.top="-"+((this.radius+this.width)>>1)+"px"}loader.style.borderRightColor="transparent"},start:function(){if(this.timerID){clearInterval(this.timerID);if(document.getElementById("loaderContainer")){document.body.removeChild(window.indicator.loading)}}if(window.addEventListener&&document.getElementById("loaderContainer")==undefined){this.loading=document.createElement("div");this.loading.id="loaderContainer";var b=document.createElement("div");b.id="loader";this.loading.appendChild(b);document.body.appendChild(this.loading);this.exec();this.isPlay=true}},stop:function(){if(this.loading){this.loading.style.opacity=0;this.loading.style.filter="alpha(opacity=100)";this.timerID=setTimeout(function(){if(document.getElementById("loaderContainer")){document.body.removeChild(window.indicator.loading)}this.timerID=undefined},10)}this.isPlay=false}};window.Canvas=function(b,a,c){this.uid=b;this.el=document.createElement("canvas");this.el.id=this.uid;this.el.width=this.width=a;this.el.height=this.height=c;this.cw=0;this.ch=0;this.aspect=a/c;this.ctx=this.el.getContext("webgl")||this.el.getContext("experimental-webgl");if(this.ctx){document.body.appendChild(this.el)}};window.Canvas.prototype.clear=function(d,c,a){var e=this.ctx;e.viewport(0,0,this.el.width,this.el.height);e.clearColor(d,c,a,1);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)};window.Canvas.prototype.alpha=function(a){this.el.style.opacity=a};window.Shader=function(b,c,a){this.gl=b;this.program=b.createProgram();this.vert=c;this.frag=a;this.vs=this.createShader(c,b.VERTEX_SHADER);this.fs=this.createShader(a,b.FRAGMENT_SHADER);this.gl.attachShader(this.program,this.fs);this.gl.attachShader(this.program,this.vs);this.gl.linkProgram(this.program);if(this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)){this.gl.useProgram(this.program)}else{console.log(this.gl.getProgramInfoLog(this.program))}};window.Shader.prototype.begin=function(){this.gl.useProgram(this.program)};window.Shader.prototype.end=function(){this.gl.useProgram(null)};window.Shader.prototype.setup=function(a){var b=this.gl;this.begin();b.bindBuffer(b.ARRAY_BUFFER,a);b.enableVertexAttribArray(b.getAttribLocation(this.program,"v"));b.vertexAttribPointer(b.getAttribLocation(this.program,"v"),3,b.FLOAT,false,0,0);b.uniformMatrix4fv(b.getUniformLocation(this.program,"p"),false,[1.732051,0,0,0,0,1.732051,0,0,0,0,-1.020202,-1,0,0,-2.020202,0]);b.uniformMatrix4fv(b.getUniformLocation(this.program,"m"),false,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-1.732051,1]);this.end()};window.Shader.prototype.createShader=function(c,a){var b=this.gl.createShader(a);this.gl.shaderSource(b,c);this.gl.compileShader(b);if(!this.gl.getShaderParameter(b,this.gl.COMPILE_STATUS)){console.log(this.gl.getShaderInfoLog(b))}return b};window.Plane=function(a){this.vertex=[-1,1,0,1,1,0,-1,-1,0,1,-1,0];this.vertices=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vertices);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);this.index=[0,1,2,3,2,1];this.indices=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indices);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Int16Array(this.index),a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);this.gl=a};window.Plane.prototype.draw=function(){var a=this.gl;a.drawElements(a.TRIANGLES,this.index.length,a.UNSIGNED_SHORT,0)};window.Texture=function(c,b,a){this.gl=c;this.width=b.width;this.height=b.height;console.log(this.width,this.height);this.texture=c.createTexture();c.bindTexture(c.TEXTURE_2D,this.texture);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT);c.texImage2D(c.TEXTURE_2D,0,c.RGB,c.RGB,c.UNSIGNED_BYTE,b);c.bindTexture(c.TEXTURE_2D,null)};Texture.prototype.bind=function(b,a,c){var d=this.gl;d.activeTexture(33984+c);d.bindTexture(d.TEXTURE_2D,this.texture);d.uniform1i(d.getUniformLocation(b.program,a),c)};Texture.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)};Texture.prototype.replace=function(b){var a=this.gl;a.bindTexture(a.TEXTURE_2D,this.texture);a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,b);a.bindTexture(a.TEXTURE_2D,null)};window.FBO=function(c,a,b){this.width=a;this.height=b;this.frameBuffer=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,this.frameBuffer);this.renderBuffer=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,a,b);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,this.renderBuffer);this.texture=c.createTexture();c.bindTexture(c.TEXTURE_2D,this.texture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this.texture,0);c.bindFramebuffer(c.FRAMEBUFFER,null);c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindTexture(c.TEXTURE_2D,null);this.gl=c};window.FBO.prototype.begin=function(d,c,a){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer);if(d!=undefined&&c!=undefined&&a!=undefined){this.gl.viewport(0,0,this.width,this.height);this.gl.clearColor(d,c,a,1);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}};window.FBO.prototype.end=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)};window.FBO.prototype.bind=function(b,a,c){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture);this.gl.uniform1i(this.gl.getUniformLocation(b.program,a),c)};window.FBO.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null)};var canvas=new Canvas("stage",1920,1088);var inter=new Image();inter.onload=function(){var a=new Image();a.onload=function(){var i=new Stats();i.showPanel(0);document.body.appendChild(i.dom);var h=canvas.ctx;var k=new Plane(h);var m=new Texture(h,inter);var f=new Texture(h,a);var e=[new FBO(h,2048,2048),new FBO(h,2048,2048)];var j="attribute vec3 v;uniform mat4 p;uniform mat4 m;varying vec2 vt;void main(void){gl_Position=p*m*vec4(v,1.);vt=((v+1.)*.5).xy;}";var b=new Shader(h,j,"precision highp float;uniform sampler2D t1;varying vec2 vt;void main(void){gl_FragColor=vec4(texture2D(t1,vec2(vt.x,1.-vt.y)).rgb,1.);}");var d=new Shader(h,j,"precision highp float;uniform sampler2D t1;uniform sampler2D t2;varying vec2 vt;void main(void){float tx=vt.x;float ty=vt.y;float iy=1.-ty;float c=1./2048.;float w=1920.;float h=1088.;vec2 xy=vec2(tx,ty);float m=texture2D(t2,vec2(tx+w*c,iy)*.5).b;float d=texture2D(t2,vec2(tx,iy)*.5).b;vec3 yuv=vec3(0.,0.,0.);vec2 p1=vec2(tx,iy);vec2 p2=vec2(tx*.5,iy*.5+h*c);vec2 p3=vec2((tx+w*c)*.5,iy*.5+h*c);vec3 diff=vec3(texture2D(t2,p1).r-texture2D(t2,p1).g,texture2D(t2,p2).r-texture2D(t2,p2).g,texture2D(t2,p3).r-texture2D(t2,p3).g);if(m>.5){if(d>.5){float vx=(texture2D(t2,vec2(tx,iy+(h*c))*.5).b*255.)-128.;float vy=(texture2D(t2,vec2(tx+(w*c),iy+(h*c))*.5).b*255.)-128.;yuv=texture2D(t1,xy+vec2(vx,-vy)*.5*c).rgb+diff;}else{yuv=texture2D(t1,xy).rgb;}}else{yuv=(d>.5)?diff+.5:texture2D(t1,xy).rgb;}gl_FragColor=vec4(yuv,1.);}");var g=new Shader(h,j,"precision highp float;uniform sampler2D t1;varying vec2 vt;void main(void){vec3 yuv=texture2D(t1,vec2(vt.x,(1.-(1088.)/2048.)+(vt.y))).rgb;float y=1192.*(yuv.r*255.-16.);float u=yuv.g*255.-128.;float v=yuv.b*255.-128.;float r=y+1634.*v;float g=y-401.*u-832.*v;float b=y+2065.*u;r=(r<0.)?0.:(r>=261120.)?1.:(r/261120.);g=(g<0.)?0.:(g>=261120.)?1.:(g/261120.);b=(b<0.)?0.:(b>=261120.)?1.:(b/261120.);gl_FragColor=vec4(r,g,b,1.);}");b.setup(k.vertices);d.setup(k.vertices);g.setup(k.vertices);var l=function(o,n,p){o.begin();h.activeTexture(h.TEXTURE0);n.bind(o,"t1",0);if(p){h.activeTexture(h.TEXTURE1);p.bind(o,"t2",1)}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,k.indices);k.draw();n.unbind();if(p){p.unbind()}o.end()};var c=0;setInterval(function(){i.begin();canvas.clear(0,0,0);if(c&1){e[1].begin(0,0,0);l(d,e[0],f);e[1].end();l(g,e[1])}else{e[0].begin(0,0,0);if(c==0){l(b,m)}else{l(d,e[1],f)}e[0].end();l(g,e[0])}c++;i.end()},1000/120);if(window.indicator.isPlay){window.indicator.stop();canvas.alpha(1)}};a.src="rdm.png"};inter.src="inter.jpg";window.indicator.start();</script></body></html>